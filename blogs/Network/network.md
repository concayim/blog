---
title: 以Nas搭建为主题集网络于一体的心路历程
tags: 
  - 网络
date: 2022-01-27 10:22:39
categories:
  - 网络
---

## 1.前言

​		前段时间心血来潮，想自己买个nas回来玩玩，但又想省钱，一开始是买了一个白群的ds110J，开始就是奔着这个docker功能去的，买回来之后发现不能安装docker，毅然决定退货，退回去了，商家说有个划痕，减了50，终于退款成功了，这个过程我是一脸懵逼的，不是所有的群辉都可以用docker的吗？原来是arm架构的不行，要x86的才行。

​		没办法，只能在闲鱼淘一个黑群了。

​		在闲鱼上跟很多人聊了，也碰到了几个恶心的人，明明下单发货了，发货那天说不发了，没时间，叫我取消订单，整个人裂开，浪费时间。后来看到一个460多的4盘位，跟别的差不多，因为我对配置不是太了解，在朋友的怂恿下就买了。好在价格也不太贵，卖家也愿意线下交货，到公元前站把这个10斤的大铁块就搬回家了~

​		搬回家之后就趁热打铁开始整备，先是看看系统有没有问题，然后还原系统...然后就...没有然后了

​		**--成功地把系统给整崩了--**

​		整个人是崩溃的，那天从晚上11点搞到凌晨5点，终于把系统搞回半白，后面熬不住终于也一直没管这个大铁块了。

​		**就是这个大铁块↓**

![星际蜗牛黑群晖](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023839.jpg)

​		这个东西其实也就是一个主机而已，没什么特别的东西，就是硬盘位比较多，而且能装群晖系统。

----

## 2.开端

​		后面又心血来潮，决定把整个大铁块废弃掉了，准备买一个白群晖算了，然后就入手了群晖的ds218+。这次终于有正宗的docker了，运行docker需要4G以上的RAM，还好上家用户有一条4G的，加起来是6G，还不错，￥1500大洋。

​		买回来就赶紧配置，正好又遇上加班潮，配置了2周，总算将东西配置好了。下一章详细说说配置的过程。

----

## 3.正文

### 3.1 光猫+路由篇

*真的是折腾啊...*

#### A.向宽带服务商申请公网ip

​		这里以电信为例，直接拨打10000号跟客服说要申请公网ip，就会有专门的工程人员帮忙恢复公网的ip，但是现在还不能直接使用，要重启光猫。

#### B.配置路由拨号桥接光猫

​		跟朋友沟通了一下，说光猫拨号会影响无线网络的性能，所以毅然购买了网件的R6300V2，刷了梅林系统，本来是想用内置的fq工具，后面发现这个功能不太稳定，所以就弃用了。

​		购买了路由器之后，由于要设置成路由拨号，光猫桥接的方式，在网上找了很多资料，具体操作流程如下：

##### 光猫端

​		1.网线一端插到光猫wan口，一端插到电脑网卡网口。到光猫后台，一般是192.168.1.1，输入超级管理员账号与密码。

```json
{
  username:xxx
  password:xxx
}
```

​		2.进入光猫设置界面后，点击“网络”菜单，默认进入宽带设置界面。

​		3.当你想把光猫设置为桥接模式时候，在用户名称那里选择 2_INTERNET_B_VID_41,下面的参数保持默认的情况，直接在左下角点击“保存”按钮就行了。

​		4.当你想把光猫设置为路由模式的时候，在用户名称那里同样选择 2_INTERNET_B_VID_41，然后进行参数的更改。首先连接模式选择路由，之后会出现用户名和密码输入栏，在用户名那里输入宽带连接的账号，密码输入宽带的密码；其他参数保持不变，点击保存按钮，然后重新启动路由器就行了。

​		5.还有一个步骤，非常的关键，就是把路由模式后面的dhcp取消掉，就是因为这个，折腾了3天。。。进入光猫设置界面后，点击“网络”菜单，然后点击“网络”菜单下的“用户侧管理”进入光猫IP地址设置界面

​		6.在用户侧管理界面可以根据自己的需要修改光猫的本地IP地址，如果想要关闭光猫的DHCP地址分配功能请把“启用DHCP Server”前面的打钩去掉；修改完之后请记得点击“保存”按钮之后再重启光猫

##### 路由器端

​		1.把刚刚接在光猫上的网线接到路由器的lan口，再找一条网线，一端接到光猫的wan口，一端接到路由器的lan口。这样的话，一个完整的链路就完成了，从光猫开始，到路由器，再到台式机器。

​		**光猫的网段是192.168.1.x**

​		**路由器的网段是192.168.50.x**

​		**所以台式机器的网段也是50网段**

​		*这里要注意一个事情， 当台式机网线连接到路由器的时候，就不能直接通过192.168.1.1连接到光猫了，因为不同的网段不能直接连，这个问题后续可能需要用光猫的wifi功能，或者是别的方式解决，有待考究啊。*

​		2.由于路由器的固件是梅林，首先在wan端设置路由器拨号。首先设置上网模式是桥接模式，输入宽带用户名密码；然后设置dhcp，默认就好了。

![路由器的wan设置](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023669.JPG)

![路由器的lan设置](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023801.JPG)

​		3.重启路由器，完事。

**就这么简单。**

*最后的路由器跟光猫的连接如下所示*

![光猫接线](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023539.JPG)

![路由接线](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023116.JPG)

-----

### 3.2 腾讯云配置+Nas篇

在配置nas之前，先上腾讯云申请一个域名，绑定https证书。￥121就有5年的域名了。

#### A.腾讯云

##### 1.获取密钥

登陆 [DNSPod.cn](https://www.dnspod.cn/) 管理控制台 - `右上角` - 安全设置 - `左侧导航` - 密钥管理 - 创建密钥

##### 2.创建 DDNS 域名

为 DDNS 单独创建一个域名，设置 A 记录到任意 IP ，本文以www.concayim.com为例。

![腾讯云ddns控制台](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023238.png)

主机记录就写www，记录类型写A，记录值随便填，填1.1.1.1就行了，后面会自动改变。



**--基础网络已经打通了--**

#### B.Nas

##### 1.组装机器

nas到手，先打开硬盘仓， 把硬盘按照合适的位置装上去，拿一条网线，一端接到nas的网口，一端接到路由的lan口上。开机等系统重新安装。

##### 2.打开ssh连接

在系统中配置打开ssh连接，端口是22。

##### 3.安装docker

##### 4.创建配置文件

群晖 NAS 中使用**文本编辑器**在任意位置创建任意文件，本文以`/docker/dnspod`为例.复制粘贴以下配置信息，`并修改前三项`，`后三项选填`，可保持默认。

```
LOGIN_TOKEN=token_id,token
DOMAIN=domain.com
SUB_DOMAIN=www
INTERVAL=5
EMAIL=you@email.com
IP_COUNT=1
```

- token_id,token是上面腾讯云初始化的id和token，以逗号分隔
- DOMAIN是域名
- SUB_DOMAIN是前缀

##### 5.保存配置文件

保存任意文件格式及位置，无需指定文件后缀名。

##### 6.启动ddns容器

A.群晖 docker - 注册表
B.搜索`dnspod`找到`strahe/dnspod-ddns`并下载`latest`最新版.

![docker镜像](https://pic-1304161434.cos.ap-guangzhou.myqcloud.com/img/202201271023335.png)

C.高级设置 - 勾选启用自动重新启动

D.添加`文件`,注意并非`文件夹`,选择上文创建的`dnspod`文件,挂载路径为`/etc/dnspod/ddnsrc`.

E.**配置完成,容器启动并查看详情.**

----

## 4.结语

配置完成了。

折腾

