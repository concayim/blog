(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{576:function(s,n,t){"use strict";t.r(n);var e=t(13),a=Object(e.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"理论基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理论基础"}},[s._v("#")]),s._v(" 理论基础")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#ingress-v1beta1-networking-k8s-io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress"),t("OutboundLink")],1),s._v(" 公开了从集群外部到集群内"),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务"),t("OutboundLink")],1),s._v("的 HTTP 和 HTTPS 路由。 流量路由由 Ingress 资源上定义的规则控制。")]),s._v(" "),t("p",[s._v("下面是一个将所有流量都发送到同一 Service 的简单 Ingress 示例：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202311241029919.png",alt:"ingress示例"}})]),s._v(" "),t("p",[s._v("使用Ingress的重要原因是，每个service如果希望暴露给集群外部都需要一个负载均衡器以及一个独有的公网IP地址，而Ingress只需要一个公网IP地址就能为许多服务提供访问。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202311241029484.png",alt:""}})]),s._v(" "),t("p",[s._v("要使用Ingress，必须要有Ingress控制器，K8S支持多种Ingress控制器，常用的有HAProxy 与 Nginx控制器。")]),s._v(" "),t("h2",{attrs:{id:"安装ingress-控制器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装ingress-控制器"}},[s._v("#")]),s._v(" 安装Ingress 控制器")]),s._v(" "),t("p",[s._v("参考官网：")]),s._v(" "),t("p",[s._v("https://kubernetes.github.io/ingress-nginx/deploy/")]),s._v(" "),t("p",[s._v("Helm公网安装最新版本（要搭梯子下载镜像）：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update\nhelm show values ingress-nginx/ingress-nginx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ingress-values.yaml\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" myingress ingress-nginx/ingress-nginx --values ingress-values.yaml -n ingress-nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"ingress使用范例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress使用范例"}},[s._v("#")]),s._v(" Ingress使用范例")]),s._v(" "),t("h3",{attrs:{id:"创建两个测试用的pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建两个测试用的pod"}},[s._v("#")]),s._v(" 创建两个测试用的Pod")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run nginx1 --image=nginx --image-pull-policy='IfNotPresent'")]),s._v("\npod/nginx1 created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run nginx2 --image=nginx --image-pull-policy='IfNotPresent'")]),s._v("\npod/nginx2 created\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod")]),s._v("\nNAME             READY   STATUS    RESTARTS   AGE\nnginx1           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          81m\nnginx2           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          81m\nnginx3-default   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m19s\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose pod nginx1 --port=80 --target-port=80")]),s._v("\nservice/nginx1 exposed\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose pod nginx2 --port=80 --target-port=80")]),s._v("\nservice/nginx2 exposed\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc")]),s._v("\nNAME             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes       ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   128m\nnginx1           ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".202.107   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    81m\nnginx2           ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".175.93    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    81m\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"修改nginx-web页面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx-web页面"}},[s._v("#")]),s._v(" 修改Nginx Web页面")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec nginx1 -it -- bash")]),s._v("\nroot@nginx1:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo AAAAAA >/usr/share/nginx/html/index.html")]),s._v("\nroot@nginx1:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec nginx2 -it -- bash")]),s._v("\nroot@nginx2:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo BBBBBB >/usr/share/nginx/html/index.html")]),s._v("\nroot@nginx2:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"到master或worker主机上验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#到master或worker主机上验证"}},[s._v("#")]),s._v(" 到Master或worker主机上验证")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.105.82.83")]),s._v("\nAAAAAA\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.103.158.125")]),s._v("\nBBBBBB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"创建ingress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建ingress"}},[s._v("#")]),s._v(" 创建Ingress")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202311241032706.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"虚拟主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机"}},[s._v("#")]),s._v(" 虚拟主机")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ingress-multi-hosts.yaml")]),s._v("\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: name-virtual-host-ingress\nspec:\n  ingressClassName: nginx\n  defaultBackend:\n    service:\n      name: nginx1\n      port:\n        number: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  rules:\n  - host: nginx1.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: nginx1\n            port:\n              number: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  - host: nginx2.example.com\n    http:\n      paths:\n      - pathType: Prefix\n        path: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        backend:\n          service:\n            name: nginx2\n            port:\n              number: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f ingress-multi-hosts.yaml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ingress")]),s._v("\nNAME                        CLASS   HOSTS                                   ADDRESS   PORTS   AGE\nname-virtual-host-ingress   nginx   nginx1.example.com,nginx2.example.com             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      15m\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("测试：")]),s._v(" "),t("p",[s._v("在clientvm上使用vi修改LB的文件，使用ingress 的service的HostPort替换以下的80端口：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setenforce 0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -4 /etc/haproxy/haproxy.cfg")]),s._v("\n    balance roundrobin\n    server worker1 worker1:80 check\n    server worker2 worker2:80 check\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart haproxy.service")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#到worker1修改/etc/hosts,增加一行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@worker1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".241.134 clientvm.example.com clientvm nginx1.example.com nginx2.example.com\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@worker1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://nginx1.example.com/")]),s._v("\nAAAAAA\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@worker1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://nginx2.example.com/")]),s._v("\nBBBBBB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"annotations的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#annotations的作用"}},[s._v("#")]),s._v(" annotations的作用")]),s._v(" "),t("p",[s._v("Ingress 经常使用注解（annotations）来配置一些选项，具体取决于 Ingress 控制器，例如 "),t("a",{attrs:{href:"https://github.com/kubernetes/ingress-nginx/blob/master/docs/examples/rewrite/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("重写目标注解"),t("OutboundLink")],1),s._v("。 不同的 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/ingress-controllers",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress 控制器"),t("OutboundLink")],1),s._v(" 支持不同的注解。查看文档以供你选择 Ingress 控制器，以了解支持哪些注解。")]),s._v(" "),t("p",[s._v("参考：https://github.com/kubernetes/ingress-nginx/blob/master/docs/examples/rewrite/README.md")]),s._v(" "),t("p",[s._v("范例 1：")]),s._v(" "),t("p",[s._v("ingress-nginx Version 0.22.0版本以后")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\n......\nspec:\n  rules:\n  - host: rewrite.bar.com\n    http:\n      paths:\n      - backend:\n          serviceName: http-svc\n          servicePort: 80\n        path: /something(/|$)(.*)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("(.*)捕获的任何字符都将被分配给占位符$2，然后将其作为重写目标注释中的参数使用")]),s._v(" "),t("p",[s._v("上面的输入定义将导致以下重写:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("rewrite.bar.com/something")]),s._v(" rewrites to "),t("code",[s._v("rewrite.bar.com/")])]),s._v(" "),t("li",[t("code",[s._v("rewrite.bar.com/something/")]),s._v(" rewrites to "),t("code",[s._v("rewrite.bar.com/")])]),s._v(" "),t("li",[t("code",[s._v("rewrite.bar.com/something/new")]),s._v(" rewrites to "),t("code",[s._v("rewrite.bar.com/new")])]),s._v(" "),t("li",[t("code",[s._v("rewrite.bar.com/")]),s._v(" 将会匹配错误，因为没有匹配上预定义path /something")])]),s._v(" "),t("p",[s._v("范例 2：")]),s._v(" "),t("p",[s._v("在上例的基础上增加如下")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  annotations:\n    nginx.ingress.kubernetes.io/app-root: /something/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("任何对http://rewrite.bar.com/ 的访问都定向到http://rewrite.bar.com/something/")]),s._v(" "),t("p",[s._v("范例3：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('  annotations:\n    kubernetes.io/ingress.class: "nginx"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("使用ingress class： nginx")]),s._v(" "),t("p",[s._v("此功能在1.22版本上已经废弃，被替换为")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("spec:\n  ingressClassName: nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);n.default=a.exports}}]);